{
	"id": "helloworld",
	"env": "dev",
	"apps":[
		{
			"name": "consul-{{.Id}}-{{.Env}}",
			"type": "consul",
			"config":"config.json",
			"data":"/data/{{.Id}}/consul"
		},
		{
			"name": "golangA-{{.Id}}-{{.Env}}",
			"type": "golang",
			"repo": "git@github.com:aminjam/golang-negroni-helloworld.git",
			"host": "helloworld-golang-app.com",
			"data": "/data/{{.Id}}/golang/golangA-{{.Id}}-{{.Env}}",
			"image":"aminjam/tahr-consul-golang",
			"ports": [3000],
			"start": "/start.sh"

		},
		{
			"name": "nodejsA-{{.Id}}-{{.Env}}",
			"type": "nodejs",
			"repo": "git@github.com:aminjam/express-hello-world.git",
			"host": "helloworld-nodejs-app.com",
			"data": "/data/{{.Id}}/nodejs/nodejsA-{{.Id}}-{{.Env}}",
			"image":"aminjam/tahr-consul-nodejs",
			"ports": [3001],
			"start": "/start.sh app.js"
		},
		{
			"name": "mongodbA-{{.Id}}-{{.Env}}",
			"type":"mongodb",
			"ports": [27017],
			"data":"/data/{{.Id}}/mongodb/mongodbA-{{.Id}}-{{.Env}}"
		}
	],
	"servers":[
		{
			"role": "web",
			"type": "load-balanced",
			"apps":["{{index .Apps 1}}","{{index .Apps 2}}"]
		},
		{
			"role": "db",
			"type": "single",
			"apps":["{{index .Apps 3}}"]
		}
	],
	"playbooks":[
		{
			"name": "ambd.backend",
			"play": "push-docker.yml",
			"inventory": "*",
			"state": "running",
			"app": "{{index .Apps 0}}",
			"actions":[
				{
					"image": "aminjam/tahr-ambd",
					"params": ""
				},
				{
					"image": "aminjam/tahr-ambd",
					"params": ""
				}
			]
		},
		{
			"name": "{{(index .Apps 0).Name}}",
			"play": "push-docker.yml",
			"inventory": "*",
			"state": "running",
			"app": "{{index .Apps 0}}",
			"action": [{
				"image": "aminjam/tahr-consul",
				"params": ""
			}]
		},
		{
			"name": "{{(index .Apps 1).Name}}",
			"play": "deploy-app.yml",
			"inventory": "ec2_web_{{(index .Apps 1).Name}}",
			"app": "{{index .Apps 1}}",
			"state": "deploying",
			"links": ["ambd.backend"],
			"action": [{
				"image":"{{.App.Image}}",
				"params":"-v {{.App.Data}}:/home/golang-app/src/deployed-app -e VIRTUAL_HOST={{.App.Host}} --link {{index .Links 0}}:db -d {{.App.Image}} {{.App.Start}}"
			}]
		}
	]
}